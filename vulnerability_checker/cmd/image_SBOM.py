import subprocess
import csv
# This program takes in a image container and runs syft on it to create an SBOM 
# Right now this is hard coded. However, I will have to change it so that I can get the sbom for each version per each container image
# so this is the sbom for 1 container image in v1.18.20

# plan to get container images of all versions! 

# Define the image name
image_name = "k8s.gcr.io/kube-apiserver-s390x:v1.18.20"

print(f"Running Syft on image: {image_name}")

try:
    # run syft on the specified image and store the result in a csv file
    result = subprocess.run(["syft", image_name], stdout=subprocess.PIPE, check=True, text=True)
    sbom_csv_data = result.stdout

    # naming csv file
    csv_file_name = "syft_analysis.csv"
    
    with open(csv_file_name, 'w', newline='') as csv_file:
        # Write the CSV data to the file
        csv_file.write(sbom_csv_data)

    print(f"Syft analysis completed for image: {image_name}\n")
    print(f"Syft analysis data saved to {csv_file_name}")
except subprocess.CalledProcessError:
    print(f"Syft analysis failed for image: {image_name}\n")
