import subprocess

def run_grype(image_name: str):
    """
    Run the grype command with the given image name.
    """
    command = [
        "grype",
        image_name,
        "--add-cpes-if-none",
        "--by-cve"
    ]
    subprocess.run(command)

def filter_image_name(name: str):
    return name.replace("SPDXRef-Package-k8s.gcr.io-", "k8s.gcr.io/").replace("SPDXRef-Package-registry.k8s.io-", "registry.k8s.io/").replace("arm64-v","arm64:v")

def main():
    test_images = ["SPDXRef-Package-k8s.gcr.io-kube-scheduler-arm64-v1.23.0-alpha.1", "SPDXRef-Package-registry.k8s.io-conformance-arm64-v1.29.0-alpha.1"]
    for i in test_images:
        print("testing " + i)
        run_grype(filter_image_name(i))

if __name__ == "__main__":
    main()