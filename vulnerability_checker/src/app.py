import requests
import os
import logging
from dotenv import load_dotenv

'''
This function calls the NIST CPE API. It takes in a
keyword to query and returns a list of CPEs for that
keyword.
'''
def cpes_search(query: str, apikey: str) -> list:
    url = "https://services.nvd.nist.gov/rest/json/cpes/2.0?keywordSearch=" + query
    headers = {"apikey": apikey}

    request = requests.get(url, headers=headers)
    results = request.json()

    cpes = []
    for i in results["products"]:
        cpes.append(i["cpe"]["cpeName"])

    return cpes

'''
This function calls the NIST CVE API. It takes in a
single CPE and returns a dictionary representing the
resulting CVE information.
'''
def cves_from_cpe(cpe: str, apikey: str) -> dict:
    url = "https://services.nvd.nist.gov/rest/json/cves/2.0?cpeName=" + cpe
    headers = {"apikey": apikey}

    request = requests.get(url, headers=headers)
    if request:
        cves = request.json()
        print(cves)
    else:
        cves = []
    return cves